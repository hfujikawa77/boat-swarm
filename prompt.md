# ArduPilotボート群制御アプリケーション開発プロンプト

ArduPilotボート3機の群制御アプリケーションをPymavlinkで作成してください。

## 要件

### 基本仕様
- 3機のボート（SITL）を対話的に編隊制御するPythonアプリケーション
- pymavlinkを使用してMAVLink通信を実装
- TCP接続で各機体と通信（ポート: 5762=1号機, 5772=2号機, 5782=3号機）

### 機能要件

1. **初期化処理**
   - 3機すべてに接続
   - 各機体の状態（モード、ARM状態）を確認
   - 未ARMまたはGUIDEDモード以外の場合は、既存の`boat_arm_guided.py`モジュールを利用してGUIDED/ARM設定

2. **対話式コマンド**
   - ユーザー入力を受け付ける対話式インターフェース
   - 以下のコマンドに対応：
     - `E`: 東方向に整列（1号機を基準に10m間隔）
     - `W`: 西方向に整列（1号機を基準に10m間隔）
     - `S`: 南方向に整列（1号機を基準に10m間隔）
     - `N`: 北方向に整列（1号機を基準に10m間隔）
     - `L`: 2,3号機をLOITERモードに設定（その場で停止）
     - `Q`: 終了
   - 複数コマンドの連続実行に対応（例: "ENWSL"で5つのコマンドを順次実行）

3. **編隊制御ロジック**
   - 1号機の現在位置を基準点として使用
   - 2,3号機のウェイポイントを計算：
     - 1号機: 現在位置を維持
     - 2号機: 指定方向に10m
     - 3号機: 指定方向に20m
   - 全機体が目標位置到着後、北向き（0度）に方位を固定

4. **移動制御**
   - SET_POSITION_TARGET_GLOBAL_INTメッセージで位置と方位を同時に制御
   - 2,3号機のみ移動（1号機は常に現在位置を維持）
   - 移動状況をリアルタイムで表示

### 実装上の注意点
- 緯度経度の計算では地球の曲率を考慮（緯度による経度の距離変化）
- エラーハンドリングを適切に実装
- Ctrl+Cでの安全な終了処理
- デバッグ用の状態表示機能

### 参考情報
- ArduPilot RoverのモードID: GUIDED=15, LOITER=5
- 位置精度の許容誤差: 約2m
- 既存モジュール`boat_arm_guided.py`のBoatFleetクラスを活用可能

このアプリケーションにより、3機のボートを様々なパターンで編隊飛行させることができます。